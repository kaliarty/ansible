---

- tags:
    - monitoring
  block:

    - name: check if we have been included
      fail:
        msg: ansible_parent_role_names is not set. This role acts on behalf of another role only; you have to include it.
      when: ansible_parent_role_names is not defined

    - name: get monitoring rules file name
      set_fact:
        _monitoring_ruleset_name: "{{ inventory_hostname }}:{{ monitoring_ruleset_name | default(ansible_parent_role_names | join(':')) }}"
        _autogenerated_job_name: "{{ monitoring_ruleset_name | default(ansible_parent_role_names[0]) }}"

    - name: configure monitoring on the monitoring server
      include_tasks:
        file: ruleset_store.yml
      loop: "{{ monitoring_server_list }}"
      loop_control:
        loop_var: mon_server
      vars:
        on_behalf: "{{ inventory_hostname }}"
