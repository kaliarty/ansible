
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Ataccama">
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.3, mkdocs-material-8.0.2">
    
    
      
        <title>Certificates - Ansible for ONE 2.0</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.816931ca.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.9204c3b2.min.css">
        
      
    
    
    
      
    
    
    <script>function __md_scope(e,t,_){return new URL(_||(t===localStorage?".":"."),location).pathname+"."+e}function __md_get(e,t=localStorage,_){return JSON.parse(t.getItem(__md_scope(e,t,_)))}function __md_set(e,t,_=localStorage,o){try{_.setItem(__md_scope(e,_,o),JSON.stringify(t))}catch(e){}}</script>
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#certificates" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="Ansible for ONE 2.0" class="md-header__button md-logo" aria-label="Ansible for ONE 2.0" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Ansible for ONE 2.0
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Certificates
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="Ansible for ONE 2.0" class="md-nav__button md-logo" aria-label="Ansible for ONE 2.0" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Ansible for ONE 2.0
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        Introduction
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="installing_ansible.html" class="md-nav__link">
        Installation & requirements
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="inventory.html" class="md-nav__link">
        Ansible inventory
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="running_ansible.html" class="md-nav__link">
        Running Ansible
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="tat.html" class="md-nav__link">
        Ansible installation tips & tricks
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="secrets.html" class="md-nav__link">
        Encrypting secrets
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="hybrid.html" class="md-nav__link">
        Hybrid DPE installation using Ansible
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="inventory_examples.html" class="md-nav__link">
        Inventory examples
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Certificates
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="certificates.html" class="md-nav__link md-nav__link--active">
        Certificates
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#supported-certificate-types" class="md-nav__link">
    Supported certificate types
  </a>
  
    <nav class="md-nav" aria-label="Supported certificate types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provided-certificates" class="md-nav__link">
    Provided certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#own-ca-signed-certificates" class="md-nav__link">
    Own CA-signed certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#letsencrypt-certificates" class="md-nav__link">
    LetsEncrypt certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#self-signed-certificates" class="md-nav__link">
    Self-signed certificates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-a-custom-ca-with-one-desktop-and-one-webapp" class="md-nav__link">
    Use a custom CA with One Desktop and One WebApp
  </a>
  
    <nav class="md-nav" aria-label="Use a custom CA with One Desktop and One WebApp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-ca-to-a-system-truststore" class="md-nav__link">
    Adding CA to a system truststore
  </a>
  
    <nav class="md-nav" aria-label="Adding CA to a system truststore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    Windows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#macos" class="md-nav__link">
    MacOS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-ca-to-the-one-desktop-java-keystore" class="md-nav__link">
    Adding CA to the One Desktop java keystore
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="glossary.html" class="md-nav__link">
        Glossary
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#supported-certificate-types" class="md-nav__link">
    Supported certificate types
  </a>
  
    <nav class="md-nav" aria-label="Supported certificate types">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#provided-certificates" class="md-nav__link">
    Provided certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#own-ca-signed-certificates" class="md-nav__link">
    Own CA-signed certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#letsencrypt-certificates" class="md-nav__link">
    LetsEncrypt certificates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#self-signed-certificates" class="md-nav__link">
    Self-signed certificates
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#use-a-custom-ca-with-one-desktop-and-one-webapp" class="md-nav__link">
    Use a custom CA with One Desktop and One WebApp
  </a>
  
    <nav class="md-nav" aria-label="Use a custom CA with One Desktop and One WebApp">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#adding-ca-to-a-system-truststore" class="md-nav__link">
    Adding CA to a system truststore
  </a>
  
    <nav class="md-nav" aria-label="Adding CA to a system truststore">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#windows" class="md-nav__link">
    Windows
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#linux" class="md-nav__link">
    Linux
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#macos" class="md-nav__link">
    MacOS
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#adding-ca-to-the-one-desktop-java-keystore" class="md-nav__link">
    Adding CA to the One Desktop java keystore
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                

<h1 id="certificates">Certificates</h1>
<p>The Gen2 platform requires a TLS configuration to protect traffic between users and application endpoints, and to protect traffic between Gen2 components.</p>
<h2 id="supported-certificate-types">Supported certificate types</h2>
<p>You can issue self-signed certificates, certificates signed by your own CA, or LetsEncrypt certificates using Ansible, or use Ansible to install the provided certificates.</p>
<h3 id="provided-certificates">Provided certificates</h3>
<p>The preferable way of installing certificates is to use customer-provided certificates.
All other options should be used only for POC, testing purposes, or as a temporary solution.
To use provided certificates, you should put them in the <code>ansible/files/certificates</code> folder, and then set the next variables in your inventory:</p>
<pre><code class="language-yaml">nginx_cert_kind: provided
nginx_certificates:
  - cn: one.customer.domain.tld
    kind: provided
    ca: &quot;certificates/customerCA.crt&quot;
    cert: &quot;certificates/{{ nginx_domain }}-fullchain.crt&quot;
    cert_key: &quot;certificates/{{ nginx_domain }}.key&quot;
</code></pre>
<p>You can use a custom folder with the certificates. In this case, you should put the full folder's path in <code>ca</code>, <code>cert</code> and <code>cert_key</code> variables.
If the customer uses an external well-known CA to sign his certificates, you can omit <code>ca</code> variable.
If the <code>nginx_certificates</code> list contains more than one certificate, you must specify <code>ca</code> variable only once, f.e., in the first element of the list. If you specify more than one <code>ca</code> variables, Ansible will show you an error.
CA certificate will also be added to system truststore and to java keystore.
See the information below for the details about how to use custom CA certificates in One Desktop and for One WebApp.</p>
<h3 id="own-ca-signed-certificates">Own CA-signed certificates</h3>
<p>There is an option to create your own CA certificate and issue certificates signed by this CA. The result is a usable Platform, except for end user workstations (web browsers etc.):
you'll need to make the CA certificate trusted manually.
To use this, you can set the next variables in your inventory:</p>
<pre><code class="language-yaml">nginx_cert_kind: ownca
nginx_certificates:
  - cn: one.customer.domain.tld
    kind: ownca
    altnames:
      - grafana.customer.domain.tld
      - kibana.customer.domain.tld
      - ...
</code></pre>
<p>CA issuing can be configured by defining the next variables:</p>
<pre><code class="language-yaml">ownca_common_name: one-ca
ownca_privatekey_passphrase: null
ownca_email_address: null
ownca_ca_not_after: &quot;+3650d&quot;
ownca_certs_not_after: &quot;+3650d&quot;
</code></pre>
<p>CA certificate will also be added to system truststore and to java keystore.
This option should be used ONLY for testing purposes or for POC.
See the information below for the details about how to use custom CA certificates in One Desktop and for One WebApp.</p>
<h3 id="letsencrypt-certificates">LetsEncrypt certificates</h3>
<p>This option can be used ONLY for internal testing purposes and cannot be used on a customer's side.
Only Microsoft Azure environments are supported.
To enable LetsEncrypt certificates issuing, set the next variables in your inventory:</p>
<pre><code class="language-yaml">le_email: your_email
le_cloud_provider: azure
le_azure_subscription_id: your_azure_subscription_id
le_azure_resource_group: your_azure_resource_group
le_azure_dns_zone_name: your_azure_dns_zone_name
le_azure_key_vault_name: your_azure_key_vault_name

nginx_certificates:
  - cn: &quot;*.your_nginx_domain&quot;
    kind: letsencrypt
</code></pre>
<h3 id="self-signed-certificates">Self-signed certificates</h3>
<p>Self-signed certificates can be used ONLY to check if Ansible installation works, f.e. on your local machine. This option isn't guaranteed to create a functioning Platform.
The latest OpenSSL versions don't support self-signed certificates, so a system installed using them won't work. Generally, you should use the Own CA as described above for POCs,
specialized installs etc. To use self-signed certificates, you can set the next variables in your inventory:</p>
<pre><code class="language-yaml">nginx_cert_kind: selfsigned
nginx_certificates:
  - cn: one.test.domain.tld
    kind: selfsigned
    altnames:
      - grafana.test.domain.tld
      - kibana.test.domain.tld
      - ...
</code></pre>
<h2 id="use-a-custom-ca-with-one-desktop-and-one-webapp">Use a custom CA with One Desktop and One WebApp</h2>
<p>You can't use One Desktop and One WebApp right after the installation that was performed using a custom (provided or own-issued) CA certificate.
To use them, you should add this CA to the system truststore and to the One Desktop java keystore on the computer where One Desktop and One WebApp are supposed to be used.</p>
<h3 id="adding-ca-to-a-system-truststore">Adding CA to a system truststore</h3>
<h4 id="windows">Windows</h4>
<ul>
<li>Right-click the CA certificate file, choose Install Certificate. The Certificate Import wizard appears.</li>
<li>In the wizard, choose Next. Then, when you are prompted for the Certificate Store, choose Place all certificates in the following store. Select the <strong>Trusted Root Certification Authorities</strong> store.</li>
<li>Complete the remaining steps of the wizard and click Finish.</li>
</ul>
<h4 id="linux">Linux</h4>
<ul>
<li>Copy the CA certificate to the ca-certificates folder.
  For Debian-based distros: <code>/usr/local/share/ca-certificates</code>
  For RedHat-based distros: <code>/etc/pki/ca-trust/source/anchors</code></li>
<li>
<p>Update certificates with this command:
  For Debian-based distros: <code>sudo /usr/sbin/update-ca-certificates</code>
  For RedHat-based distros: <code>sudo /bin/update-ca-trust</code></p>
</li>
<li>
<p>You must have  latest version of ca-certificates package installed in Debian based distros.</p>
</li>
</ul>
<h4 id="macos">MacOS</h4>
<ul>
<li>Open the CA certificate with Keychain application. If the CA certificate has <code>.crt</code> or <code>.cer</code> extension, Keychain should open by double-clicking on the file.</li>
<li>Choose System from the Keychain option and press OK.</li>
<li>Choose Always Trust everywhere on the next window and click the Always Trust button.</li>
<li>Then you will notice that the certificate is added to the system entry.</li>
</ul>
<h3 id="adding-ca-to-the-one-desktop-java-keystore">Adding CA to the One Desktop java keystore</h3>
<p>Use the next command to add the CA certificate to the One Desktop java keystore:</p>
<pre><code class="language-shell">/path-to-one-desktop-installed/jre/bin/keytool \
  -import \
  -keystore /path-to-one-desktop-installed/jre/lib/security/cacerts \
  -alias one-ca \
  -file path-to-your-ca-certificate \
  -storepass changeit \
  -noprompt
</code></pre>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="inventory_examples.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Inventory examples" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Inventory examples
            </div>
          </div>
        </a>
      
      
        
        <a href="glossary.html" class="md-footer__link md-footer__link--next" aria-label="Next: Glossary" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Glossary
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": ".", "features": [], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "assets/javascripts/workers/search.01824240.min.js"}</script>
    
    
      <script src="assets/javascripts/bundle.ff0eccb3.min.js"></script>
      
    
  </body>
</html>